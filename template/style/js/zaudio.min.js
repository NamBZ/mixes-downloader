"use strict";var _Mathfloor=Math.floor,_createClass=function(){function b(c,d){for(var g,f=0;f<d.length;f++)g=d[f],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,g.key,g)}return function(c,d,f){return d&&b(c.prototype,d),f&&b(c,f),c}}();function _classCallCheck(b,c){if(!(b instanceof c))throw new TypeError("Cannot call a class as a function")}var zAudio=function(){function b(c,d){_classCallCheck(this,b),this.DOMElement=document.getElementById(c.divId),this.autoPlay=c.autoplay,this.playList=d,this.playlistOpen=!1,this.enableDownload=c.download,this.miniPlayer=c.miniplayer,this.repeatAll=!1,this.shuffle=c.shuffle,this.defaultVolume=c.defaultVolume?c.defaultVolume:50,this.themeColor=c.color?c.color:"#FF9900",1<this.playList.length?this._renderPlaylist(this.playList):this._initialize()}return _createClass(b,[{key:"_stringGen",value:function _stringGen(c){for(var d=" ",f="abcdefghijklmnopqrstuvwxyz0123456789",g=0;g<c;g++)d+=f.charAt(_Mathfloor(Math.random()*f.length));return d}},{key:"_initialize",value:function _initialize(){var c=this,d=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._initTemplate(d),this.trackTitle=this.DOMElement.getElementsByClassName("zaudio_songtitle")[0],this.trackArtist=this.DOMElement.getElementsByClassName("zaudio_songartist")[0],this.albumArt=this.DOMElement.getElementsByClassName("zaudio_art")[0],this.downloadButton=this.DOMElement.getElementsByClassName("zaudio_download_button")[0],this.playButton=this.DOMElement.getElementsByClassName("zaudio_btn_play")[0],this.stopButton=this.DOMElement.getElementsByClassName("zaudio_btn_stop")[0],this.repeatButton=this.DOMElement.getElementsByClassName("zaudio_btn_repeat")[0],this.playlistButton=this.DOMElement.getElementsByClassName("zaudio_btn_playlist")[0],this.volumeButton=this.DOMElement.getElementsByClassName("zaudio_btn_mute")[0],this.seekbar=this.DOMElement.getElementsByClassName("zaudio_seekbg")[0],this.volumebar=this.DOMElement.getElementsByClassName("zaudio_seekbg")[1],600>this.DOMElement.offsetWidth&&(this.DOMElement.getElementsByClassName("zaudio_art")[0].style.flex=1,this.DOMElement.getElementsByClassName("zaudio_art")[0].style.backgroundPosition="center",this.DOMElement.getElementsByClassName("zaudio_art")[0].style.backgroundColor="#5e5e5e"),this.playlistButton&&(this.playlistButton.style.color=this.themeColor),this.seekbar.children[0].style.backgroundColor=this.themeColor,this.seekbar.children[0].children[0].style.borderColor=this.themeColor,this.volumebar.children[0].style.backgroundColor=this.themeColor,this.volumebar.children[0].children[0].style.borderColor=this.themeColor,this.audioElement=document.getElementById(this.tagId),this._mobileCheck()?this.volumebar.style.display="none":this.audioElement.volume=(this.defaultVolume/100).toFixed(1),this.audioElement.autoplay=this.autoPlay,this.shuffle?this.changeTrack(this._getRandomTrackIndex()):this.changeTrack(0),this.autoPlay&&this.audioElement.play(),this.audioElement.onplaying=function(){c.playButton.innerHTML="pause",sessionStorage.setItem("za_isplaying",!0)},this.audioElement.onpause=function(){c.playButton.innerHTML="play_arrow"};var f=document.createElement("DIV"),g=document.createTextNode("Streaming");this.audioElement.onstalled=function(){g.nodeValue="Media Unavailable",f.style.backgroundColor="#dbd7d7"},this.audioElement.onwaiting=function(){c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].innerHTML="<div class=\"zaudio_spinner\"></div>",c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].children[0].style.borderTopColor=c.themeColor},this.audioElement.oncanplay=function(){"Infinity"==c.audioElement.duration?(c.seekbar.style.display="none",f.className="zaudio_stream_circle",c.DOMElement.getElementsByClassName("zaudio_seekbar")[0].appendChild(f),c.DOMElement.getElementsByClassName("zaudio_seekbar")[0].appendChild(g),c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].style.fontSize="20px",c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].style.paddingLeft="0px",c.stopButton.style.display="none",c.repeatButton.style.display="none",c.enableDownload&&(c.downloadButton.style.display="none")):(c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].innerHTML=c.formatTime(c.audioElement.duration),!c.miniPlayer&&(c.seekbar.removeAttribute("style"),c.stopButton.removeAttribute("style"),c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].removeAttribute("style")))},this.audioElement.onended=function(){c.playButton.innerHTML="play_arrow",c.isPlaying=!1,d&&(c.shuffle?(c.changeTrack(c._getRandomTrackIndex()),c.audioElement.play()):c.repeatAll&&c.nowPlayingIndex+1==c.playList.length?(c.changeTrack(0),c.audioElement.play(),c.playlistElement.scrollTop=0):c.nowPlayingIndex+1!=c.playList.length&&(c.changeTrack(c.nowPlayingIndex+1),c.audioElement.play()))},this.audioElement.onerror=function(){},this.audioElement.ontimeupdate=function(){var h=100*(c.audioElement.currentTime/c.audioElement.duration);c.DOMElement.getElementsByClassName("zaudio_seekfill")[0].style.width=h+"%",c.DOMElement.getElementsByClassName("zaudio_tracktime")[0].innerHTML=c.formatTime(c.audioElement.currentTime)},this._handleInputs()}},{key:"_mobileCheck",value:function _mobileCheck(){var c=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c}},{key:"_handleInputs",value:function _handleInputs(){var c=this,d=this;this.changeVolume=function(f){var g=f.pageX-d._getOffsetLeft(d.volumebar),h=g/d._getOffsetWidth(d.volumebar);0<h&1>h&&(d.volumebar.children[0].style.width=_Mathfloor(100*h)+"%",d.audioElement.volume=h.toFixed(2),h=h.toFixed(2),0.8<h?d.volumeButton.innerHTML="volume_up":0.8>h&0.1<h?d.volumeButton.innerHTML="volume_down":0.1>h&&(d.volumeButton.innerHTML="volume_mute"))},this.volumebar.addEventListener("mousedown",function(){window.addEventListener("mousemove",c.changeVolume,!0)}),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",c.changeVolume,!0)}),this.seekbar.addEventListener("click",function(f){var g=f.pageX-c._getOffsetLeft(c.seekbar),h=g*c.audioElement.duration/c._getOffsetWidth(c.seekbar);c.audioElement.currentTime=h}),this.enableDownload&&this.downloadButton.addEventListener("click",function(){c._saveFile(c.playList[c.nowPlayingIndex].downloadLink||c.playList[c.nowPlayingIndex].url)}),this.DOMElement.getElementsByClassName("zaudio_buttonwrapper")[0].addEventListener("click",function(f){switch(f.target.innerHTML){case"play_arrow":this.audioElement.play(),this._pauseOtherInstances(),f.target.innerHTML="pause";break;case"pause":this.audioElement.pause(),f.target.innerHTML="play_arrow";break;case"volume_down":case"volume_mute":this.audioElement.muted=!0,f.target.innerHTML="volume_off";break;case"volume_off":this.audioElement.muted=!1,f.target.innerHTML="volume_down";break;case"fast_forward":this.audioElement.playbackRate+=0.5,2<this.audioElement.playbackRate&&(this.audioElement.playbackRate=1);break;case"stop":this.audioElement.pause(),this.playButton.innerHTML="play_arrow",this.audioElement.currentTime=0;break;case"skip_next":this.changeTrack(this.nowPlayingIndex+1),this.audioElement.play(),this._pauseOtherInstances();break;case"skip_previous":this.changeTrack(this.nowPlayingIndex-1),this.audioElement.play(),this._pauseOtherInstances();break;case"queue_music":f.target.style.color=this.playlistOpen?"":this.themeColor,this._togglePlaylist();break;case"repeat":this.repeatAll?(this.audioElement.loop=!1,f.target.removeAttribute("style"),this.repeatAll=!1):(this.audioElement.loop=!0,f.target.innerHTML="repeat_one");break;case"repeat_one":this.repeatAll?(this.audioElement.loop=!1,f.target.innerHTML="repeat"):1<this.playList.length?(f.target.style.color=this.themeColor,this.repeatAll=!0,this.audioElement.loop=!1,f.target.innerHTML="repeat"):(this.audioElement.loop=!1,f.target.innerHTML="repeat");}}.bind(this))}},{key:"_pauseOtherInstances",value:function _pauseOtherInstances(){for(var c=document.getElementsByTagName("audio"),d=0,f=c.length;d<f;d++)c[d]!=this.audioElement&&c[d].pause()}},{key:"_getRandomTrackIndex",value:function _getRandomTrackIndex(){var c=_Mathfloor(Math.random()*this.playList.length);return c==this.nowPlayingIndex?this._getRandomTrackIndex():c}},{key:"_getOffsetLeft",value:function _getOffsetLeft(c){var d=c.getBoundingClientRect();return d.left}},{key:"_getOffsetWidth",value:function _getOffsetWidth(c){var d=c.getBoundingClientRect();return d.right-d.left}},{key:"changeTrack",value:function changeTrack(c){if(c!=this.nowPlayingIndex&&this.playList.length>c&&0<=c){var d=this.playList[c];this.trackTitle.innerHTML=d.title?d.title:"",this.trackArtist.innerHTML=d.artist?d.artist:"",this.albumArt.style.backgroundImage="url("+d.albumArturl+")",this.audioElement.src=d.url,this.nowPlayingIndex=c,1<this.playList.length&&this._setActiveItem(this.playlistElement.children[c])}}},{key:"_saveFile",value:function _saveFile(c){var d=c.substring(c.lastIndexOf("/")+1).split("?")[0],f=new XMLHttpRequest;f.responseType="blob",f.onload=function(){var g=document.createElement("a");g.href=window.URL.createObjectURL(f.response),g.download=d,g.style.display="none",document.body.appendChild(g),g.click()},f.open("GET",c),f.send()}},{key:"_togglePlaylist",value:function _togglePlaylist(){this.DOMElement.getElementsByClassName("zaudio_playlist")[0].style.maxHeight=this.playlistOpen?"0px":"200px",this.playlistOpen=!this.playlistOpen}},{key:"formatTime",value:function formatTime(c){var d=_Mathfloor(c/60),f=("0"+_Mathfloor(c-60*d)).slice(-2);return d+":"+f}},{key:"_initTemplate",value:function _initTemplate(c){var d=this.miniPlayer?"zaudio_wrapper_min":c?"":"zaudio_wrapper_noplaylist";this.tagId="a_"+new Date().getUTCMilliseconds();var f="\n\t\t\t<div class=\"zaudio_wrapper "+d+"\">\n\t\t\t\t<audio id=\""+this.tagId+"\"></audio>\n\t\t\t\t<div class=\"zaudio_container\">\n\t\t\t\t\t\t<div class=\"zaudio_art\" "+(this.miniPlayer?"style=\"display:none\"":"")+">\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"zaudio_player\">\n\t\t\t\t\t\t\t<div class=\"zaudio_trackinfo\">\n\t\t\t\t\t\t\t\t<div class=\"zaudio_playercontrolbuttons\" style=\"display:flex;flex-direction:row;justify-content:space-between;\"><span "+(this.miniPlayer?"style=\"font-size:16px;\"":"")+" class=\"zaudio_songtitle\"></span>\n\t\t\t\t\t\t\t\t"+(this.enableDownload?"<i class=\"material-icons zaudio_icons zaudio_download_button\">file_download</i>":"<span/>")+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span "+(this.miniPlayer?"style=\"font-size:14px;\"":"")+" class=\"zaudio_songartist\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"zaudio_playercontrols\">\n\t\t\t\t\t\t\t\t<div class=\"zaudio_seekbar\">\n\t\t\t\t\t\t\t\t\t<div "+(this.miniPlayer?"style=\"display:none\"":"")+" class=\"zaudio_seekbg\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"zaudio_seekfill\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"zaudio_seeker\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t"+(this.miniPlayer?"":"<span class=\"zaudio_tracktime\">0:00</span>")+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"zaudio_buttonwrapper\">\n\t\t\t\t\t\t\t\t\t<div class=\"zaudio_playercontrolbuttons noselect\">\n\t\t\t\t\t\t\t\t\t\t"+(c?"<i class=\"material-icons zaudio_icons zaudio_btn_prev\">skip_previous</i>":"")+"\n\t\t\t\t\t\t\t\t\t\t<i class=\"material-icons zaudio_icons zaudio_btn_play\" style=\"color:"+this.themeColor+";\">play_arrow</i>\n\t\t\t\t\t\t\t\t\t\t<i "+(this.miniPlayer?"style=\"display:none\"":"")+" class=\"material-icons zaudio_icons zaudio_btn_stop\">stop</i>\n\t\t\t\t\t\t\t\t\t\t"+(c?"<i class=\"material-icons zaudio_icons zaudio_btn_next\">skip_next</i>":"")+"\n\t\t\t\t\t\t\t\t\t\t<i "+(this.miniPlayer?"style=\"display:none\"":"")+"class=\"material-icons zaudio_icons zaudio_btn_repeat\">repeat</i>\n\t\t\t\t\t\t\t\t\t\t"+(this.miniPlayer?"<span class=\"zaudio_tracktime zaudio_tracktime_mini\">0:00</span>":"")+"\n\t\t\t\t\t\t\t\t\t\t"+(c&&!this.miniPlayer?"<i class=\"material-icons zaudio_icons zaudio_btn_playlist\" style=\"color:${this.themeColor}\">queue_music</i>":"")+"\n\t\t\t\t\t\t\t\t\t\t<i class=\"material-icons zaudio_icons zaudio_btn_mute\">volume_down</i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"zaudio_seekbg\" style=\"height:5px; max-width:20%;\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"zaudio_seekfill\" style=\"height:5px;width:"+this.defaultVolume+"%;\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"zaudio_seeker\" style=\"height:12px;min-width:12px;\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t</div>\n\t\t";this.DOMElement.innerHTML=f}},{key:"_setActiveItem",value:function _setActiveItem(c){this.activeItem!=c&&(this.activeItem&&(this.activeItem.removeAttribute("style"),this.activeItem.children[4].innerHTML="play_arrow"),c.style.backgroundColor="#ececec",c.children[4].innerHTML="volume_up",this.activeItem=c)}},{key:"_renderPlaylist",value:function _renderPlaylist(c){for(var g,d="",f=0;f<c.length;f++)g=c[f],d+="\n\t\t\t\t<li data-id=\""+f+"\">\n\t\t\t\t\t<img src=\""+g.albumArturl+"\"/>\n\t\t\t\t\t<span>"+g.title+"</span>\n\t\t\t\t\t<span>"+g.artist+"</span>\n\t\t\t\t\t<span style=\"flex-grow:1;\"></span>\n\t\t\t\t\t<i class=\"material-icons\" style=\"color:#a3a3a3;\">play_arrow</i>\n\t\t\t\t</li>\n\t\t\t";var h=document.createElement("UL");h.className="zaudio_playlist noselect",h.style.display=this.miniPlayer?"none":"",h.innerHTML=d,this.playlistElement=h,this._initialize(!0),this.DOMElement.children[0].appendChild(h),this._togglePlaylist();var j=this;h.addEventListener("click",function(k){for(var l=k.target;l&&l.parentNode!=h;)if(l=l.parentNode,!l)return;"LI"===l.tagName&&(j.changeTrack(parseInt(l.dataset.id)),j.audioElement.play(),j._pauseOtherInstances())})}}]),b}();
